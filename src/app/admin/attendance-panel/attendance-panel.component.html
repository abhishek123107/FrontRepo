<div class="container-fluid">
  <h2 class="mb-4">Attendance Panel</h2>

  <!-- Date Filter -->
  <div class="card mb-4">
    <div class="card-body">
      <div class="row align-items-center">
        <div class="col-md-4">
          <label class="form-label">Select Date</label>
          <input
            type="date"
            class="form-control"
            [(ngModel)]="selectedDate"
            (change)="loadAttendance()"
          />
        </div>
        <div class="col-md-4">
          <label class="form-label">Filter by Status</label>
          <select
            class="form-select"
            [(ngModel)]="statusFilter"
            (change)="filterAttendance()"
          >
            <option value="all">All</option>
            <option value="present">Present</option>
            <option value="absent">Absent</option>
            <option value="pending">Pending</option>
          </select>
        </div>
        <div class="col-md-4">
          <button class="btn btn-primary w-100" (click)="generateQRCode()">
            <i class="bi bi-qr-code"></i> Generate Today's QR Code
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- QR Code Display -->
  <div class="card mb-4" *ngIf="qrCodeData">
    <div class="card-header">
      <h5>Today's QR Code</h5>
    </div>
    <div class="card-body text-center">
      <div id="qrcode" class="d-inline-block"></div>
      <p class="mt-3 text-muted">
        Students can scan this QR code to mark their attendance
      </p>
    </div>
  </div>

  <!-- Attendance Table -->
  <div class="card">
    <div class="card-header">
      <h5>Attendance Records - {{ selectedDate | date : "mediumDate" }}</h5>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Student Name</th>
              <th>Seat Number</th>
              <th>Check-in Time</th>
              <th>Check-out Time</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let record of filteredAttendance">
              <td>{{ record.studentName }}</td>
              <td>{{ record.seatNumber }}</td>
              <td>{{ record.checkInTime | date : "shortTime" }}</td>
              <td>
                {{
                  record.checkOutTime
                    ? (record.checkOutTime | date : "shortTime")
                    : "-"
                }}
              </td>
              <td>
                <span
                  class="badge"
                  [class.bg-success]="record.status === 'present'"
                  [class.bg-danger]="record.status === 'absent'"
                  [class.bg-warning]="record.status === 'pending'"
                >
                  {{ record.status }}
                </span>
              </td>
              <td>
                <button
                  *ngIf="record.status === 'pending'"
                  class="btn btn-success btn-sm me-2"
                  (click)="approveAttendance(record)"
                >
                  <i class="bi bi-check"></i> Approve
                </button>
                <button
                  *ngIf="record.status === 'pending'"
                  class="btn btn-danger btn-sm"
                  (click)="rejectAttendance(record)"
                >
                  <i class="bi bi-x"></i> Reject
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        *ngIf="filteredAttendance.length === 0"
        class="text-center text-muted mt-4"
      >
        <p>No attendance records found for the selected date.</p>
      </div>
    </div>
  </div>

  <!-- Statistics -->
  <div class="row mt-4">
    <div class="col-md-3">
      <div class="card text-center">
        <div class="card-body">
          <h3 class="text-success">{{ getStats("present") }}</h3>
          <p class="mb-0">Present</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center">
        <div class="card-body">
          <h3 class="text-danger">{{ getStats("absent") }}</h3>
          <p class="mb-0">Absent</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center">
        <div class="card-body">
          <h3 class="text-warning">{{ getStats("pending") }}</h3>
          <p class="mb-0">Pending</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center">
        <div class="card-body">
          <h3 class="text-primary">{{ attendanceRecords.length }}</h3>
          <p class="mb-0">Total</p>
        </div>
      </div>
    </div>
    <router-outlet></router-outlet>
  </div>
</div>
