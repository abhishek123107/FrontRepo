<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-4 mb-4">
      <div class="card shadow-sm text-center border-0">
        <div class="card-body p-4">
          <div class="position-relative d-inline-block mb-3">
            <img
              [src]="user?.avatar || 'https://ui-avatars.com/api/?name=' + (user?.first_name || 'User') + '&background=random&size=150'"
              class="rounded-circle img-thumbnail shadow-sm"
              [alt]="user?.first_name"
              style="width: 150px; height: 150px; object-fit: cover;"
            />
          </div>
          <h4 class="fw-bold mb-1">{{ user?.first_name }} {{ user?.last_name }}</h4>
          <p class="text-muted small mb-3">
            <i class="bi bi-person-badge me-1"></i> Student ID: {{ user?.student_id || 'N/A' }}
          </p>
          <hr />
          <div class="d-grid gap-2">
            <span class="badge" [ngClass]="user?.is_staff ? 'bg-danger' : 'bg-primary'">
              {{ user?.is_staff ? 'Administrator' : 'Student Member' }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-8">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
          <h5 class="mb-0 fw-bold text-primary">Profile Information</h5>
          <button class="btn btn-sm" 
                  [ngClass]="isEditMode ? 'btn-outline-danger' : 'btn-primary'" 
                  (click)="toggleEdit()">
            <i class="bi" [ngClass]="isEditMode ? 'bi-x-lg' : 'bi-pencil-square'"></i>
            {{ isEditMode ? 'Cancel' : 'Edit Profile' }}
          </button>
        </div>

        <div class="card-body p-4">
          <form [formGroup]="profileForm" (ngSubmit)="onUpdateProfile()">
            
            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <label class="form-label small fw-bold">First Name</label>
                <input type="text" class="form-control" formControlName="first_name" 
                       [readonly]="!isEditMode" [class.bg-light]="!isEditMode" />
              </div>
              <div class="col-md-6">
                <label class="form-label small fw-bold">Last Name</label>
                <input type="text" class="form-control" formControlName="last_name" 
                       [readonly]="!isEditMode" [class.bg-light]="!isEditMode" />
              </div>
            </div>

            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <label class="form-label small fw-bold">Email Address</label>
                <input type="email" class="form-control" formControlName="email" 
                       [readonly]="!isEditMode" [class.bg-light]="!isEditMode" />
              </div>
              <div class="col-md-6">
                <label class="form-label small fw-bold">Mobile Number</label>
                <input type="text" class="form-control" formControlName="phone" 
                       [readonly]="!isEditMode" [class.bg-light]="!isEditMode" />
              </div>
            </div>

            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <label class="form-label small fw-bold">Department</label>
                <input type="text" class="form-control" formControlName="department" 
                       [readonly]="!isEditMode" [class.bg-light]="!isEditMode" />
              </div>
              <div class="col-md-6">
                <label class="form-label small fw-bold">Year of Study</label>
                <input type="text" class="form-control" formControlName="year_of_study" 
                       [readonly]="!isEditMode" [class.bg-light]="!isEditMode" />
              </div>
            </div>

            <div *ngIf="isEditMode" class="d-grid gap-2">
              <button type="submit" class="btn btn-success" [disabled]="loading || profileForm.invalid">
                <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
                {{ loading ? 'Updating Profile...' : 'Save Changes' }}
              </button>
            </div>

            <div *ngIf="success" class="alert alert-success mt-3 py-2 small shadow-sm border-0">
              <i class="bi bi-check-circle-fill me-2"></i> {{ success }}
            </div>
            <div *ngIf="error" class="alert alert-danger mt-3 py-2 small shadow-sm border-0">
              <i class="bi bi-exclamation-triangle-fill me-2"></i> {{ error }}
            </div>

          </form>
        </div>
      </div>
    </div>
  </div>
</div>